(function(c){var j=[];c.extend(c.fn,{fgMenu:function(k){if(!this.length){k&&k.debug&&window.console&&console.warn("nothing selected, can't make menu, returning nothing");return}this.each(function(){var n=this;var l=c.data(n,"famenu");if(l){return l}var l=new d(n,k);j.push(l);c(this).click(function(){if(!l.menuOpen){l.showLoading()}if(l.menuOpen==false){l.showMenu()}else{l.kill()}return false});c.data(n,"famenu",l)})}});function d(n,m){var o=this;var p=m.content;if(p instanceof Function){var p=p.call(n)}var n=c(n);var k=c('<div class="fg-menu-container ui-widget ui-widget-content ui-corner-all">'+p+"</div>");this.menuOpen=false;this.menuExists=false;var m=jQuery.extend({content:null,width:180,maxHeight:180,positionOpts:{posX:"left",posY:"bottom",offsetX:0,offsetY:0,directionH:"right",directionV:"down",detectH:true,detectV:true,linkToFront:false},showSpeed:200,callerOnState:"fg-menu-active ui-state-active",loadingState:"fg-menu-loading ui-state-loading",linkHover:"fg-menu-hover ui-state-hover",linkHoverSecondary:"li-hover",crossSpeed:200,crumbDefaultText:"Choose an option:",backLink:true,backLinkText:"Back",flyOut:false,flyOutOnState:"fg-menu-default ui-state-default",nextMenuLink:"ui-icon-triangle-1-e",topLinkText:"All",nextCrumbLink:"ui-icon-carat-1-e"},m);var l=function(){c.each(j,function(q){if(j[q].menuOpen){j[q].kill()}})};this.kill=function(){n.removeClass(m.loadingState).removeClass("fg-menu-open").removeClass(m.callerOnState);k.find("li").removeClass(m.linkHoverSecondary).find("a").removeClass(m.linkHover);if(m.flyOutOnState){k.find("li a").removeClass(m.flyOutOnState)}if(m.callerOnState){n.removeClass(m.callerOnState)}if(k.is(".fg-menu-ipod")){o.resetDrilldownMenu()}if(k.is(".fg-menu-flyout")){o.resetFlyoutMenu()}k.parent().hide();o.menuOpen=false;c(document).unbind("click",l);c(document).unbind("keydown")};this.showLoading=function(){n.addClass(m.loadingState)};this.showMenu=function(){l();if(!o.menuExists){o.create()}n.addClass("fg-menu-open").addClass(m.callerOnState);k.parent().show().click(function(){o.kill();return false});k.hide().slideDown(m.showSpeed).find(".fg-menu:eq(0)");o.menuOpen=true;n.removeClass(m.loadingState);c(document).click(l);c(document).keydown(function(t){var u;if(t.which!=""){u=t.which}else{if(t.charCode!=""){u=t.charCode}else{if(t.keyCode!=""){u=t.keyCode}}}var s=(c(t.target).parents("div").is(".fg-menu-flyout"))?"flyout":"ipod";switch(u){case 37:if(s=="flyout"){c(t.target).trigger("mouseout");if(c("."+m.flyOutOnState).size()>0){c("."+m.flyOutOnState).trigger("mouseover")}}if(s=="ipod"){c(t.target).trigger("mouseout");if(c(".fg-menu-footer").find("a").size()>0){c(".fg-menu-footer").find("a").trigger("click")}if(c(".fg-menu-header").find("a").size()>0){c(".fg-menu-current-crumb").prev().find("a").trigger("click")}if(c(".fg-menu-current").prev().is(".fg-menu-indicator")){c(".fg-menu-current").prev().trigger("mouseover")}}return false;break;case 38:if(c(t.target).is("."+m.linkHover)){var r=c(t.target).parent().prev().find("a:eq(0)");if(r.size()>0){c(t.target).trigger("mouseout");r.trigger("mouseover")}}else{k.find("a:eq(0)").trigger("mouseover")}return false;break;case 39:if(c(t.target).is(".fg-menu-indicator")){if(s=="flyout"){c(t.target).next().find("a:eq(0)").trigger("mouseover")}else{if(s=="ipod"){c(t.target).trigger("click");setTimeout(function(){c(t.target).next().find("a:eq(0)").trigger("mouseover")},m.crossSpeed)}}}return false;break;case 40:if(c(t.target).is("."+m.linkHover)){var q=c(t.target).parent().next().find("a:eq(0)");if(q.size()>0){c(t.target).trigger("mouseout");q.trigger("mouseover")}}else{k.find("a:eq(0)").trigger("mouseover")}return false;break;case 27:l();break;case 13:if(c(t.target).is(".fg-menu-indicator")&&s=="ipod"){c(t.target).trigger("click");setTimeout(function(){c(t.target).next().find("a:eq(0)").trigger("mouseover")},m.crossSpeed)}break}})};this.create=function(){k.css({width:m.width}).appendTo("body").find("ul:first").not(".fg-menu-breadcrumb").addClass("fg-menu");k.find("ul, li a").addClass("ui-corner-all");k.find("ul").attr("role","menu").eq(0).attr("aria-activedescendant","active-menuitem").attr("aria-labelledby",n.attr("id"));k.find("li").attr("role","menuitem");k.find("li:has(ul)").attr("aria-haspopup","true").find("ul").attr("aria-expanded","false");k.find("a").attr("tabindex","-1");if(k.find("ul").size()>1){if(m.flyOut){o.flyout(k,m)}else{o.drilldown(k,m)}}else{k.find("a").click(function(){o.chooseItem(this);return false})}if(m.linkHover){var q=k.find(".fg-menu li a");q.hover(function(){var r=c(this);c("."+m.linkHover).removeClass(m.linkHover).blur().parent().removeAttr("id");c(this).addClass(m.linkHover).focus().parent().attr("id","active-menuitem")},function(){c(this).removeClass(m.linkHover).blur().parent().removeAttr("id")})}if(m.linkHoverSecondary){k.find(".fg-menu li").hover(function(){c(this).siblings("li").removeClass(m.linkHoverSecondary);if(m.flyOutOnState){c(this).siblings("li").find("a").removeClass(m.flyOutOnState)}c(this).addClass(m.linkHoverSecondary)},function(){c(this).removeClass(m.linkHoverSecondary)})}o.setPosition(k,n,m);o.menuExists=true};this.chooseItem=function(q){o.kill();c("#menuSelection").text(c(q).text());location.href=c(q).attr("href")}}d.prototype.flyout=function(k,l){var m=this;this.resetFlyoutMenu=function(){var n=k.find("ul ul");n.removeClass("ui-widget-content").hide()};k.addClass("fg-menu-flyout").find("li:has(ul)").each(function(){var o=k.width();var q,n;var p=c(this).find("ul");p.css({left:o,width:o}).hide();c(this).find("a:eq(0)").addClass("fg-menu-indicator").html("<span>"+c(this).find("a:eq(0)").text()+'</span><span class="ui-icon '+l.nextMenuLink+'"></span>').hover(function(){clearTimeout(n);var r=c(this).next();if(!e(r,c(this).offset().top)){r.css({top:"auto",bottom:0})}if(!g(r,c(this).offset().left+100)){r.css({left:"auto",right:o,"z-index":999})}q=setTimeout(function(){r.addClass("ui-widget-content").show(l.showSpeed).attr("aria-expanded","true")},300)},function(){clearTimeout(q);var r=c(this).next();n=setTimeout(function(){r.removeClass("ui-widget-content").hide(l.showSpeed).attr("aria-expanded","false")},400)});c(this).find("ul a").hover(function(){clearTimeout(n);if(c(this).parents("ul").prev().is("a.fg-menu-indicator")){c(this).parents("ul").prev().addClass(l.flyOutOnState)}},function(){n=setTimeout(function(){p.hide(l.showSpeed);k.find(l.flyOutOnState).removeClass(l.flyOutOnState)},500)})});k.find("a").click(function(){m.chooseItem(this);return false})};d.prototype.drilldown=function(k,v){var l=this;var n=k.find(".fg-menu");var r=c('<ul class="fg-menu-breadcrumb ui-widget-header ui-corner-all ui-helper-clearfix"></ul>');var w=c('<li class="fg-menu-breadcrumb-text">'+v.crumbDefaultText+"</li>");var s=(v.backLink)?v.backLinkText:v.topLinkText;var m=(v.backLink)?"fg-menu-prev-list":"fg-menu-all-lists";var u=(v.backLink)?"ui-state-default ui-corner-all":"";var q=(v.backLink)?'<span class="ui-icon ui-icon-triangle-1-w"></span>':"";var p=c('<li class="'+m+'"><a href="#" class="'+u+'">'+q+s+"</a></li>");k.addClass("fg-menu-ipod");if(v.backLink){r.addClass("fg-menu-footer").appendTo(k).hide()}else{r.addClass("fg-menu-header").prependTo(k)}r.append(w);var t=function(x){if(x.height()>v.maxHeight){x.addClass("fg-menu-scroll")}x.css({height:v.maxHeight})};var o=function(x){x.removeClass("fg-menu-scroll").removeClass("fg-menu-current").height("auto")};this.resetDrilldownMenu=function(){c(".fg-menu-current").removeClass("fg-menu-current");n.animate({left:0},v.crossSpeed,function(){c(this).find("ul").each(function(){c(this).hide();o(c(this))});n.addClass("fg-menu-current")});c(".fg-menu-all-lists").find("span").remove();r.empty().append(w);c(".fg-menu-footer").empty().hide();t(n)};n.addClass("fg-menu-content fg-menu-current ui-widget-content ui-helper-clearfix").css({width:k.width()}).find("ul").css({width:k.width(),left:k.width()}).addClass("ui-widget-content").hide();t(n);n.find("a").each(function(){if(c(this).next().is("ul")){c(this).addClass("fg-menu-indicator").each(function(){c(this).html("<span>"+c(this).text()+'</span><span class="ui-icon '+v.nextMenuLink+'"></span>')}).click(function(){var x=c(this).next();var C=c(this).parents("ul:eq(0)");var y=(C.is(".fg-menu-content"))?0:parseFloat(n.css("left"));var A=Math.round(y-parseFloat(k.width()));var E=c(".fg-menu-footer");o(C);t(x);n.animate({left:A},v.crossSpeed);x.show().addClass("fg-menu-current").attr("aria-expanded","true");var D=function(H){var F=H;var I=c(".fg-menu-current");var G=I.parents("ul:eq(0)");I.hide().attr("aria-expanded","false");o(I);t(G);G.addClass("fg-menu-current").attr("aria-expanded","true");if(G.hasClass("fg-menu-content")){F.remove();E.hide()}};if(v.backLink){if(E.find("a").size()==0){E.show();c('<a href="#"><span class="ui-icon ui-icon-triangle-1-w"></span> <span>Back</span></a>').appendTo(E).click(function(){var G=c(this);var F=parseFloat(n.css("left"))+k.width();n.animate({left:F},v.crossSpeed,function(){D(G)});return false})}}else{if(r.find("li").size()==1){r.empty().append(p);p.find("a").click(function(){l.resetDrilldownMenu();return false})}c(".fg-menu-current-crumb").removeClass("fg-menu-current-crumb");var B=c(this).find("span:eq(0)").text();var z=c('<li class="fg-menu-current-crumb"><a href="javascript://" class="fg-menu-crumb">'+B+"</a></li>");z.appendTo(r).find("a").click(function(){if(c(this).parent().is(".fg-menu-current-crumb")){l.chooseItem(this)}else{var F=-(c(".fg-menu-current").parents("ul").size()-1)*180;n.animate({left:F},v.crossSpeed,function(){D()});c(this).parent().addClass("fg-menu-current-crumb").find("span").remove();c(this).parent().nextAll().remove()}return false});z.prev().append(' <span class="ui-icon '+v.nextCrumbLink+'"></span>')}return false})}else{c(this).click(function(){l.chooseItem(this);return false})}})};d.prototype.setPosition=function(n,l,s){var k=n;var p=l;var q={refX:p.offset().left,refY:p.offset().top,refW:p.getTotalWidth(),refH:p.getTotalHeight()};var s=s;var r,o;var m=c('<div id="menuPositionHelper" class="positionHelper"></div>');m.css({position:"absolute",left:q.refX,top:q.refY,width:q.refW,height:q.refH});k.wrap(m);switch(s.positionOpts.posX){case"left":r=0;break;case"center":r=q.refW/2;break;case"right":r=q.refW;break}switch(s.positionOpts.posY){case"top":o=0;break;case"center":o=q.refH/2;break;case"bottom":o=q.refH;break}r+=s.positionOpts.offsetX;o+=s.positionOpts.offsetY;if(s.positionOpts.directionV=="up"){k.css({top:"auto",bottom:o});if(s.positionOpts.detectV&&!e(k)){k.css({bottom:"auto",top:o})}}else{k.css({bottom:"auto",top:o});if(s.positionOpts.detectV&&!e(k)){k.css({top:"auto",bottom:o})}}if(s.positionOpts.directionH=="left"){k.css({left:"auto",right:r});if(s.positionOpts.detectH&&!g(k)){k.css({right:"auto",left:r})}}else{k.css({right:"auto",left:r});if(s.positionOpts.detectH&&!g(k)){k.css({left:"auto",right:r})}}if(s.positionOpts.linkToFront){p.clone().addClass("linkClone").css({position:"absolute",top:0,right:"auto",bottom:"auto",left:0,width:p.width(),height:p.height()}).insertAfter(k)}};function b(l,k){return k-l}jQuery.fn.getTotalWidth=function(){return c(this).width()+parseInt(c(this).css("paddingRight"))+parseInt(c(this).css("paddingLeft"))+parseInt(c(this).css("borderRightWidth"))+parseInt(c(this).css("borderLeftWidth"))};jQuery.fn.getTotalHeight=function(){return c(this).height()+parseInt(c(this).css("paddingTop"))+parseInt(c(this).css("paddingBottom"))+parseInt(c(this).css("borderTopWidth"))+parseInt(c(this).css("borderBottomWidth"))};function i(){return self.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop}function f(){return self.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft}function h(){var k=document.documentElement;return self.innerHeight||(k&&k.clientHeight)||document.body.clientHeight}function a(){var k=document.documentElement;return self.innerWidth||(k&&k.clientWidth)||document.body.clientWidth}function g(l,m){var k=parseInt(m)||c(l).offset().left;return(k+c(l).width()<=a()+f()&&k-f()>=0)}function e(m,l){var k=parseInt(l)||c(m).offset().top;return(k+c(m).height()<=h()+i()&&k-i()>=0)}Number.prototype.pxToEm=String.prototype.pxToEm=function(l){l=jQuery.extend({scope:"body",reverse:false},l);var o=(this=="")?0:parseFloat(this);var n;var m=function(){var q=document.documentElement;return self.innerWidth||(q&&q.clientWidth)||document.body.clientWidth};if(l.scope=="body"&&c.browser.msie&&(parseFloat(c("body").css("font-size"))/m()).toFixed(1)>0){var p=function(){return(parseFloat(c("body").css("font-size"))/m()).toFixed(3)*16};n=p()}else{n=parseFloat(jQuery(l.scope).css("font-size"))}var k=(l.reverse==true)?(o*n).toFixed(2)+"px":(o/n).toFixed(2)+"em";return k}})(jQuery);