(function(a){a.extend(a.fn,{checkTreeview:function(d){if(!this.length){d&&d.debug&&window.console&&console.warn("no element selected, can't init data pager, returning nothing");return}var c=a.data(this[0],"checkTreeview");if(c){return c}c=new a.CheckTreeview(this[0],d);a.data(this[0],"checkTreeview",c);return c}});a.CheckTreeview=function(d,c){this.target=d;this.settings=a.extend(true,{},a.CheckTreeview.defaults,c);this.init()};var b={parentNodeClass:"hitarea",collapsableClass:"collapsable-hitarea",lastCollapsableClass:"lastCollapsable-hitarea",expandableClass:"expandable-hitarea",lastExpandableClass:"lastExpandable-hitarea"};a.extend(a.CheckTreeview,{defaults:{formId:undefined,onExpand:undefined,onCollapse:undefined,onCheck:undefined,onUnCheck:undefined,onHalfCheck:undefined,onLabelHoverOver:undefined,onLabelHoverOut:undefined,labelAction:"expand",collapseAll:true,debug:false,treeClass:"tree",nodeClass:"arrow",lastNodeClass:"last",parentNodeClass:"arrow",checkboxClass:"checkbox",halfCheckedClass:"half_checked",checkedClass:"checked",collapsableClass:"collapsed",lastCollapsableClass:undefined,expandableClass:"expanded",lastExpandableClass:undefined,liExpandedClass:"expanded",labelUI:"label"},setDefaults:function(c){a.extend(a.DataPager.defaults,c)},prototype:{init:function(){this.setOptions();this.initCheckTree()},setOptions:function(){if(!this.settings.parentNodeClass){this.settings.parentNodeClass=this.nodeClass}if(!this.settings.lastCollapsableClass){this.settings.lastCollapsableClass=this.settings.collapsableClass}if(!this.settings.lastExpandableClass){this.settings.lastExpandableClass=this.settings.expandableClass}var c=this.settings.treeClass;if(c&&c=="treeview"){this.settings=a.extend(this.settings,b)}a.extend(this,this.settings)},initCheckTree:function(){var q=a(this.target);var l=q.find("li");this._lis=l;var g=l.find(":checkbox");g.css("display","none");var e=this.nodeClass;var j=this.lastNodeClass;var n=this.parentNodeClass;var d=this.checkboxClass;var k=this.halfCheckedClass;var h=this.checkedClass;var o=this;l.not(":has(."+e+")").each(function(){$li=a(this);var u=$li.children(":checkbox:first").get(0);var x=0;var z="";if(u){var y=u.checked;x=o.subUnCheckedCount(u);var w=$li.children("label").html();var t=d;if(y){if(x>0){t+=(" "+k)}else{t+=(" "+h)}}z='<span class="'+t+'"></span>'}else{x=$li.children("ul").length-1}var v=e;var s=$li.next("li").length==1;if(s){}else{$li.addClass(j)}if(x==-1){}else{v+=(" "+n)}a(this).prepend('<span class="'+v+'"></span>'+z)});var i=this.expandableClass;var p=this.collapsableClass;var f=this.lastExpandableClass;var r=this.lastCollapsableClass;var m=this.liExpandedClass;var c=q.find("li:has(li) > ."+e);c.each(function(){var t=a(this);var w=t.parent("li");var s=w.next("li").length==1;var u=i;var v=p;if(!s){u=f;v=r}t.click(function(){w.toggleClass(m);var x=t.siblings("ul");t.toggleClass(u).toggleClass(v);if(t.is(":visible")){x.toggle()}else{x.css("display","none")}if(o.onExpand&&t.hasClass(u)){o.onExpand(t.parent())}else{if(o.onCollapse&&t.hasClass(v)){o.onCollapse(t.parent())}}}).addClass(v)});q.find(".checkbox").click(function(){var s=a(this);s.toggleClass("checked").removeClass("half_checked").siblings(":checkbox:first").attr("checked",s.hasClass("checked"));s.filter(".checked").siblings("ul:first").find(".checkbox:not(.checked)").removeClass("half_checked").addClass("checked").siblings(":checkbox").attr("checked",true);s.filter(":not(.checked)").siblings("ul:first").find(".checkbox.checked").removeClass("checked half_checked").siblings(":checkbox").attr("checked",false);s.parents("ul:first").siblings(":checkbox:first").change();if(o.onCheck&&s.hasClass("checked")){o.onCheck(s.parent())}else{if(o.onUnCheck&&s.hasClass("checked")==false){o.onUnCheck(s.parent())}}});g.change(function(){var x=a(this);var u=x.siblings(".checkbox:first");var t=x.siblings("ul:first").find(":checkbox:checked:first").length==1;var w=x.siblings("ul:first").find(":checkbox:not(:checked):first").length==1;if(t){x.attr("checked",true);if(w){u.removeClass("checked").addClass("half_checked");if(o.onHalfCheck){o.onHalfCheck(x.parent())}}else{u.removeClass("half_checked").addClass("checked")}}else{u.removeClass("checked half_checked");x.attr("checked",false)}var s=x.parent().parent().parent();if(s){var v=s.children(":checkbox");v.each(function(){a(this).change()})}});q.find("label").click(function(){switch(o.labelAction){case"expand":a(this).siblings("."+e+":first").click();break;case"check":a(this).siblings(".checkbox:first").click();break}}).hover(function(){a(this).addClass("hover");if(o.onLabelHoverOver){o.onLabelHoverOver(a(this).parent())}},function(){a(this).removeClass("hover");if(o.onLabelHoverOut){o.onLabelHoverOut(a(this).parent())}});if(this.collapseAll!=true){c.click()}return this},subUnCheckedCount:function(d){var f=a(d);var e=f.siblings("ul");if(e.length){var c=e.find(":checkbox:not(:checked)");return c.size()}return -1},clear:function(){var c=a(this.target);c.find(".checkbox").removeClass("checked").siblings(":checkbox").attr("checked",false)},reset:function(){var e=this.formId;var c=this.nodeClass;var d=this;this._lis.filter(":has(."+c+")").each(function(){var f=a(this).children(":checkbox").get(0);var i=f.checked;var h=d.subUnCheckedCount(f);var g=a(this).children("label").html();if(i){if(h>0){a(this).children(".checkbox:not(.half_checked)").removeClass("checked").addClass("half_checked")}else{a(this).children(".checkbox:not(.checked)").removeClass("half_checked").addClass("checked")}}else{a(this).children(".checkbox.half_checked").removeClass("half_checked");a(this).children(".checkbox.checked").removeClass("checked")}})}}})})(jQuery);