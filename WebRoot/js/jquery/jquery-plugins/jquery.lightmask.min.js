(function($){var isIE=(document.all)?true:false;var isIE6=isIE&&([/MSIE (\d)\.0/i.exec(navigator.userAgent)][0][1]==6);var Bind=function(object,fun){return function(){return fun.apply(object,arguments)}};$.extend($.fn,{lightMask:function(options){if(!this.length){options&&options.debug&&window.console&&console.warn("nothing selected, can't make light mask, returning nothing");return}var element=this[0];var lightmask=$.data(element,"lightmaskObj");if(lightmask){return lightmask}lightmask=new $.LightMask(options,element);$.data(element,"lightmaskObj",lightmask);return lightmask},doLightMask:function(options){if(!this.length){options&&options.debug&&window.console&&console.warn("nothing selected, can't do light mask, returning nothing");return}return this.each(function(){var lightmask=$.data(this,"lightmask");if(lightmask){lightmask.toggle();return lightmask}lightmask=new $.LightMask(options,this);$.data(this,"lightmask",lightmask);return lightmask})},unlightMask:function(options){if(!this.length){options&&options.debug&&window.console&&console.warn("nothing selected, can't close light mask, returning nothing");return}this.each(function(){var lightmask=$.data(this,"lightmask");if(!lightmask){return}lightmask.close()})}});$.LightMask=function(options,element){this.settings=$.extend(true,undefined,$.LightMask.defaults,options);this.init()};$.extend($.LightMask,{defaults:{target:document.body,boxId:undefined,autoShow:true,Over:true,Fixed:false,Center:true,onShow:undefined,loadimg:undefined,message:undefined,overLayOptions:{}},prototype:{isDebug:false,init:function(){this.setOptions();var target=this.target;this.maskAll=(this.target===document.body);var overlay=$.data(target,"OverLay");if(!overlay){overlay=new $.OverLay(this.overLayOptions,target);$.data(target,"OverLay",overlay)}this.OverLay=overlay;var boxId=this.boxId;var boxer=$("#"+boxId);if(!boxer.length){boxer=$('<div align="center" style="padding:2px;background: #FFFFFF;border: 1px solid #ccc;vertical-align:middle;width:200px;"/>').attr("id",boxId);boxer.append('<div id="loadingTitle" align="center" style="padding:2px;border: 1px solid #e0e;background:#F4F4F4;back;vertical-align:middle;font-weight:bolder;">Loading ... ...</div><hr/>');if(this.loadimg){boxer.prepend('<img src="'+this.loadimg+'" style="vertical-align:middle;" /><hr/>')}boxer.append('<div id="loadingMessage" align="center" style="padding:2px;width:100%;vertical-align:middle;font-weight:bolder;">Loading ..., please waiting...</div>')}this._box=boxer;$(target).prepend(this._box);var zIndex=overlay.zIndex+10;boxer.css({zIndex:zIndex,display:"none"});boxer.children("#loadingMessage").html(this.message);if(isIE6){this._top=this._left=0;this._select=[];this._fixed=Bind(this,function(){this.Center?this.setCenter():this.setFixed()})}if(this.autoShow){this.show()}},setDefaults:function(options){$.extend($.LightMask.defaults,options)},setOptions:function(){$.extend(this,this.settings)},setFixed:function(){var boxer=this._box;var boxOffset=boxer.offset();var boxTop=document.documentElement.scrollTop-this._top+boxOffset.top+"px";var boxLeft=document.documentElement.scrollLeft-this._left+boxOffset.left+"px";boxer.css({top:boxTop,left:boxLeft});this._top=document.documentElement.scrollTop;this._left=document.documentElement.scrollLeft},setCenter:function(){var boxer=this._box;var boxOffset=boxer.offset();var boxMarginTop=document.documentElement.scrollTop-boxOffset.height/2+"px";var boxMarginLeft=document.documentElement.scrollLeft-boxOffset.width/2+"px";boxer.css({marginTop:boxMarginTop,marginLeft:boxMarginLeft})},show:function(options){this.Over&&this.OverLay.show();var boxer=this._box;boxer.css({position:(this.Fixed&&!isIE6?"fixed":"absolute"),display:"block"});var targetObj=$(this.target);var offset=targetObj.offset();var left=offset.left;var top=offset.top;var width=targetObj.width();var height=0;if(this.maskAll){height=$(window).height()}else{height=targetObj.height()}var b_width=boxer.width();var b_height=boxer.height();if(this.isDebug){alert(targetObj[0]+":left-"+left+", top-"+top+", width-"+width+", height-"+height+"\n"+boxer[0]+": width-"+b_width+", height-"+b_height)}if(this.Center){var s_left=left+(width-b_width)/2;var s_top=top+(height-b_height)/2;boxer.css({left:s_left,top:s_top})}if(isIE6){if(!this.Over){this._select.length=0;$.each(document.getElementsByTagName("select"),Bind(this,function(o){if(!Contains(boxer,o)){o.style.visibility="hidden";this._select.push(o)}}))}this.Center?this.setCenter():this.Fixed&&this.setFixed();this.Fixed&&window.attachEvent("onscroll",this._fixed)}if(this.onShow){this.onShow()}},close:function(){this._box.css("display","none");this.OverLay.close();if(isIE6){window.detachEvent("onscroll",this._fixed);$.each(this._select,function(o){o.style.visibility="visible"})}},toggle:function(){if(this._box.css("display")=="none"){this.show()}else{this.close()}}}});$.OverLay=function(options,element){this.settings=$.extend(true,undefined,$.OverLay.defaults,options);this.init()};$.extend($.OverLay,{defaults:{target:document.body,layerId:undefined,Color:"#fff",Opacity:50,zIndex:1000,overlayClass:undefined},prototype:{isDebug:false,init:function(){this.setOptions();var target=this.target;var targetObj=$(target);var layer=$(this.layerId);if(!layer.length){layer=$('<div style="display:none; position:fixed;"/>');$(target).prepend(layer[0])}this.Layer=layer[0];var color=this.Color;var opacity=parseInt(this.Opacity);var zIndex=parseInt(this.zIndex);var left=0;var top=0;var width="100%";var height="100%";if(this.isDebug){alert(target[0]+": left-"+left+", top-"+top+", width-"+width+", height-"+height)}if(this.overlayClass){layer.addClass(this.overlayClass)}if(target!=document.body){left=targetObj.offset().left;top=targetObj.offset().top;width=targetObj.width();height=targetObj.height()}layer.css({opacity:opacity,"background-color":color,"z-index":zIndex,left:left,top:top,width:width,height:height});if(isIE6){this.Layer.style.position="absolute";if(target==document.body){this._resize=Bind(this,function(){alert("resize");this.Layer.style.width=Math.max(document.documentElement.scrollWidth,document.documentElement.clientWidth)+"px";this.Layer.style.height=Math.max(document.documentElement.scrollHeight,document.documentElement.clientHeight)+"px"});this.Layer.innerHTML='<iframe style="position:absolute;top:0;left:0;width:100%;height:100%;filter:alpha(opacity=0);"></iframe>'}}},setDefaults:function(options){$.extend($.OverLay.defaults,options)},setOptions:function(){$.extend(this,this.settings)},show:function(){if(isIE6){this._resize();window.attachEvent("onresize",this._resize)}with(this.Layer.style){isIE?filter="alpha(opacity:"+this.Opacity+")":opacity=this.Opacity/100;backgroundColor=this.Color;display="block"}},close:function(){this.Layer.style.display="none";if(isIE6){window.detachEvent("onresize",this._resize)}}}})})(jQuery);